<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Timelapse</h1>
    </div>
    <!-- /.col-lg-12 -->
</div>

<div class="row">
    <div class="col-lg-7 userProfile"></div>
    <div class="col-lg-2 userLinks"></div>
    <div class="col-lg-3 userOptions"></div>
</div>

<div class="row">
    <div class="col-lg-12 timelapseForm">
        <div class="panel panel-primary">
                        <div class="panel-heading">
                            Timelapse Generator Form
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <form id='timelapseForm' role="form">
                                        <div class="form-group">
                                            <label>Timeout (Hours)</label>
                                            <input name="timeout" class="form-control" value=0>
                                            <p class="help-block">How long will the timelapse run?</p>
                                        </div>
                                        <div class="form-group">
                                            <label>Timelapse (seconds)</label>
                                            <input name="timelapse" class="form-control" value=10>
                                            <p class="help-block">System will convert seconds to milliseconds for script generation</p>
                                        </div>
                                        <button id="generateScript" type="submit" class="btn btn-default">Submit Button</button>
                                    </form>
                                </div>
                            </div>      
                        </div>
                        <!-- /.panel-body -->





                    <!-- /.panel -->
                </div>
                        





                    </div>
                </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-12 timelapseForm">
        <div class="panel panel-primary">
                        <div class="panel-heading">
                            Script Output
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <form role="form">
                                        <div class="form-group">
                                            <label>Timelapse Script</label>
                                            <textarea id="scriptOutput" class="form-control" rows="20"></textarea>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <!-- /.row (nested) -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                        





                    </div>
                </div>
    </div>
</div>

<script>

    $('body').on('click', '#generateScript', function (e) {
        e.preventDefault();
        //alert('Script');
        renderTimelapse();

    });

    function renderTimelapse(){
        //console.log('renderTimelapse');
        var values = {};
            $.each($('#timelapseForm').serializeArray(), function(i, field) {
            values[field.name] = field.value;
        });
        console.log(values)
        convertValues(values)
        renderTimelapseForm(values);
    }

    function convertValues(values){
        if (values.timeout != 0) {
            values.timeout = values.timeout * 60 * 60 * 1000
        }
        values.timelapse = values.timelapse * 1000

    }

    function renderTimelapseForm(values){
        var html = [];
        html.push(
            `sudo raspistill
            --output /home/pi/timelapse/photos/image_%05d.jpg
            --timeout `+values.timeout+`
            --timelapse `+values.timelapse+`
            --opacity 200
            --imxfx none
            --rotation 270
            --exposure auto
            --awb auto
            `)
        $("#scriptOutput").val(html);
    }


</script>