<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Timelapse</h1>
    </div>
    <!-- /.col-lg-12 -->
</div>

<div class="row">
    <div class="col-lg-7 userProfile"></div>
    <div class="col-lg-2 userLinks"></div>
    <div class="col-lg-3 userOptions"></div>
</div>

<div class="row">
    <div class="col-lg-12 timelapseForm"></div>
</div>

<script>

    $('#table').data('url', "https://x0cqlc5za2.execute-api.ap-southeast-2.amazonaws.com/dev/userAssertions/" + loggedInUserId);

    var $table = $('#table'),
        $remove = $('#remove'),
        selections = [];

    function getIdSelections() {
        return $.map($table.bootstrapTable('getSelections'), function (row) {
            return row.badgeId
        });
    }

    function responseHandler(res) {
        $.each(res.rows, function (i, row) {
            row.state = $.inArray(row.id, selections) !== -1;
        });
        return res;
    }

    function detailFormatter(index, row) {
        var html = [];
        $.each(row, function (key, value) {
            html.push('<p><b>' + key + ':</b> ' + value + '</p>');
        });
        return html.join('');
    }

    function imageFormatter(value, row, index) {
        return [
            '<img ',
                'src="../images/badges/64/' + row.badgeId + '.png" ',
                'class="backup_picture_64 clickable_badge" onerror="imgError(this, 64);"',
                'alt=' + row.badgeId,
            '>'
        ].join('');
    }

    function dateFormatter(value, row, index){
        //return value
        return parseDateAsLocal(value)
    }

//Begin Click Functions
        function operateFormatter(value, row, index) {
            //We can add api call to add/remove/greyout buttons depending on how the user has indicated in the past
            var html = [];
            if (row.selfAssign) {
                html.push (
                    '<a class="add" href="javascript:void(0)" title="Add">',
                    '<i class="glyphicon glyphicon-plus"></i>',
                    '</a>')
                };
            html.push (
                '<a class="interest" href="javascript:void(0)" title="Interested">',
                '<i class="glyphicon glyphicon-heart" style="color:red"></i>',
                '</a>',
                '<a class="inProgress" href="javascript:void(0)" title="In Progress">',
                '<i class="glyphicon glyphicon-star" style="color:orange"></i>',
                '</a>')
            return html.join('');
        }

        //TODO: What operateEvents do we need for personal badges
        window.operateEvents = {
            'click .like': function (e, value, row, index) {

            },
            'click .remove': function (e, value, row, index) {

            },
            'click .add': function (e, value, row, index) {
                badgeid = row.badgeId;
                recipient = loggedInUserId;
                csv = parseCSVtoArray("badgeId,recipient\n" + badgeid + "," + recipient);
                console.log(csv);
                addDataToTable("userAssertions", csv);
            }
        };
//End Click Functions

    //On image error put placeholder
    window.imageEvents = {
        'error .backup_picture_64': function (e, value, row, index) {
            $(this).attr('src', '../images/badges/64/placeholder_badge.png');
        }
    };


    renderTimelapse();

    function renderTimelapse(){
        console.log('renderTimelapse');
        renderTimelapseForm();
    }

    function renderUserProfile(){
        var html = [];
        html.push(`
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <i class="fa fa-user fa-2x"></i> `+loggedInUserId+`
                    </div>

                    <div class="panel-body">
                        <img src="../images/badges/256/placeholder_user.png" class="img-responsive backup_picture_256 center-block clickable_badge" alt="">
                    </div>
                </div>
        `)
        $(".userProfile").append(html);
    };



    function renderUserOptions(){
        var html = [];
        html.push(`
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <i class="fa fa-tag fa-2x"></i> User Options
                    </div>

                    <div class="panel-body">
                        <p>
                            <button type="button" class="btn btn-primary btn-md btn-block">User Timeline</button>
                            <button id="renderEmailButton" type="button" class="btn btn-primary btn-md btn-block">Generate Email Signature</button>
                            <button type="button" class="btn btn-primary btn-md btn-block">Button 3</button>
                            <button type="button" class="btn btn-primary btn-md btn-block">Button 4</button>
                        </p>
                    </div>
                </div>
        `)
        $(".userOptions").append(html);
    };

    function renderBadgesObtained(badges){
        //console.log(badges);
        var html = [];
        var obtainedBadges = [];
        for (var i = 0; i < badges.length; i++) {
            if (badges[i].status == 'Obtained') {
                obtainedBadges.push(`
                    <img src="../images/badges/64/`+badges[i].badgeId+`.png"
                    class="clickable_badge img-responsive" style="display:inline-block"; onerror="imgError(this, 64)" alt="` + badges[i].badgeId + `">`
                )
            }
        }
        html.push(`
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <i class="fa fa-user fa-2x"></i> Obtained
                    </div>

                    <div class="panel-body">
                        <div class="text-center">
                            `+obtainedBadges+`
                        </div>
                    </div>
                </div>
        `)
        $(".badgesObtained").append(html);
    };


    //TODO
    //Refactor all reder badges into one fucntion and control with parameter
    //Duplications between my-profile and render-user
    function renderBadgesInProgress(badges){
      //console.log(badges);
        var html = [];
        var obtainedBadges = [];
        for (var i = 0; i < badges.length; i++) {
            if (badges[i].status == 'In Progress') {
                obtainedBadges.push(`
                    <img src="../images/badges/64/` + badges[i].badgeId + `.png"
                    class="clickable_badge img-responsive" style="display:inline-block"; onerror="imgError(this, 64)" alt="` + badges[i].badgeId + `">`
                )
            }
        }
        html.push(`
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <i class="fa fa-user fa-2x"></i> In Progress
                    </div>

                    <div class="panel-body">
                        <div class="text-center">
                            `+obtainedBadges+`
                        </div>
                    </div>
                </div>
        `)
        $(".badgesInProgess").append(html);
    };


    function renderBadgesInterest(badges){
        var html = [];
        var obtainedBadges = [];
        for (var i = 0; i < badges.length; i++) {
            if (badges[i].status == 'Interested') {
                obtainedBadges.push(`
                    <img src="../images/badges/64/` + badges[i].badgeId + `.png"
                    class="clickable_badge img-responsive" style="display:inline-block"; onerror="imgError(this, 64)" alt="` + badges[i].badgeId + `">`
                )
            }
        }
        html.push(`
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <i class="fa fa-user fa-2x"></i> Interest
                    </div>

                    <div class="panel-body">
                        <div class="text-center">
                            `+obtainedBadges+`
                        </div>
                    </div>

                </div>
        `)
        $(".badgesInterest").append(html);
    };


    function renderUserTimeline(data){
        var html = [];
        html.push(`
                <div class="panel panel-default">
                <div class="panel-heading">
                    <i class="fa fa-clock-o fa-fw"></i> Responsive Timeline
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <ul class="timeline">
                        <li>
                            <div class="timeline-badge"><i class="fa fa-check"></i>
                            </div>
                            <div class="timeline-panel">
                                <div class="timeline-heading">
                                    <h4 class="timeline-title">Badge Obtained</h4>
                                    <p><small class="text-muted"><i class="fa fa-clock-o"></i> 11 hours ago via Twitter</small>
                                    </p>
                                </div>
                            </div>
                        </li>
                        <li class="timeline-inverted">
                            <div class="timeline-badge warning"><i class="fa fa-credit-card"></i>
                            </div>
                            <div class="timeline-panel">
                                <div class="timeline-heading">
                                    <h4 class="timeline-title">Interest Flagged</h4>
                                </div>
                                <div class="timeline-body">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Autem dolorem quibusdam, tenetur commodi provident cumque magni voluptatem libero, quis rerum. Fugiat esse debitis optio.</p>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="timeline-badge danger"><i class="fa fa-bomb"></i>
                            </div>
                            <div class="timeline-panel">
                                <div class="timeline-heading">
                                    <h4 class="timeline-title">InProgess Flagged</h4>
                                </div>
                                <div class="timeline-body">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit.</p>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        `)
        $(".userTimeline").append(html);
    };

        function renderUserLinks(){
        var html = [];
        html.push(`
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <i class="fa fa-user fa-2x"></i> User Links
                    </div>

                    <div class="panel-body">
                        <div class="text-center">
                            <a class="btn btn-social-icon btn-facebook"><i class="fa fa-facebook"></i></a>
                            <a class="btn btn-social-icon btn-twitter"><i class="fa fa-twitter"></i></a>
                            <a class="btn btn-social-icon btn-linkedin"><i class="fa fa-linkedin"></i></a>
                            <a class="btn btn-social-icon btn-google-plus"><i class="fa fa-google-plus"></i></a>
                            <a class="btn btn-social-icon btn-github"><i class="fa fa-github"></i></a>
                        </div>
                    </div>
                </div>
        `)
        $(".userLinks").append(html);
    };

//RemoveMe
//Used to print to screen the user timeline data
function userTimeline(badges){
    //Get all assertions
    //Sort decending
    //print to screen
    //Genertate html <li>
    //Append to renderUserTimeline
    console.log("Data: ", badges)
    var html = []
    var userBadges = []
    var status = ''
    var icon = ''
    var type = ''
    var timelineClass = ''
    for (var i = 0; i < badges.length; i++) {
        status = badges[i].status
        icon = 'check'
        type = 'success'
        if (i % 2 == 0){
            timelineClass = ''
        }
        else{
            timelineClass = 'class="timeline-inverted"'
        }

        if (status == 'Obtained'){
            type = 'success'
            icon = 'check'
        }
        else{
            type = 'info'
            icon = 'info'
        }

        userBadges.push(`
            <li `+timelineClass+`>
                <div class="timeline-badge `+type+`"><i class="fa fa-`+icon+`"></i></div>
                <div class="timeline-panel">
                    <div class="timeline-heading">
                        <h4 class="timeline-title">`+badges[i].badgeId+`</h4>
                        <img src="../images/badges/64/`+badges[i].badgeId+`.png" class="backup_picture_64 clickable_badge" onerror="imgError(this, 64);" alt=`+badges[i].badgeId+`>
                        <p><small class="text-muted"><i class="fa fa-clock-o"></i> `+badges[i].status+`</small>
                        </p>
                    </div>
                </div>
            </li>
        `)
    }
    html.push(`
                <div class="panel panel-default">
                <div class="panel-heading">
                    <i class="fa fa-clock-o fa-fw"></i> User Timeline
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <ul class="timeline">
                        `+userBadges+`
                    </ul>
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        `)
    console.log(userBadges)
    console.log(html)
    $(".userTimeline").append(html);

}



</script>